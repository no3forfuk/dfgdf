const app=getApp();Component({properties:{},data:{postList:[],scrollViewHeight:0,tabItems:[{label:"全部状态",key:"all"},{label:"我关注的",key:"focused"}],unitWidth:0,photoIndex:0,floatIndex:0,scrollLeft:0,hotPeople:[],currentPeople:{},contactBottom:!1,currentPage:"all"},attached(){},ready(){wx.setNavigationBarTitle({title:"圈子·圆点社区"}),app.tools.getViewHeight({target:".circle-scroll-view",isComponent:!0,component:this,success:t=>{this.setData({scrollViewHeight:t})}}),this.getPostList(),this.getHotUser()},methods:{scrolltolower(){this.setData({contactBottom:!0})},circelScroll(t){const e=t.detail;console.log(e),console.log(e.scrollHeight-e.scrollTop),e.deltaY<0&&e.scrollTop>80?this.data.contactBottom?this.triggerEvent("showTabbar"):this.triggerEvent("hideTabbar"):(this.setData({contactBottom:!1}),this.triggerEvent("showTabbar"))},scrollUserPhoto(t){const[e,s]=[t.detail,this.data.unitWidth],o=e.scrollLeft;let a=parseFloat(o/s)-parseInt(o/s);a=a.toFixed(2),this.setData({photoIndex:parseInt(o/s),floatIndex:Number(a)})},scrollEnd(){setTimeout(()=>{this.setData({scrollLeft:this.data.photoIndex*this.data.unitWidth})},800)},getUnitWidth(){const t=wx.createSelectorQuery().in(this);t.select(".circle-header-right-scroll-box-item").boundingClientRect(),t.exec(t=>{const e=t[0].width+10;this.setData({unitWidth:e})})},go2Users(t){const e=t.currentTarget.dataset.item;wx.navigateTo({url:`/pages/user/user?oid=${e.uid}`})},focusPeople(t){const e=t.currentTarget.dataset.item;app.request.collect({params:{uid:wx.getStorageSync("u_id"),to_uid:e.uid,type:1},success:t=>{this.getHotUser()}})},getPostList(){wx.getStorage({key:"u_id",success:t=>{"all"==this.data.currentPage?app.request.getCircelIndex({params:{uid:t.data},success:t=>{let e=t.result_data.result;e=e.filter(t=>1==t.type),this.setData({postList:e})}}):"focused"==this.data.currentPage&&this.getFocusPeopleFeed()}})},addPost(){wx.navigateTo({url:"/pages/addPost/addPost"})},getHotUser(){app.request.getHotUser({params:{uid:wx.getStorageSync("u_id")},success:t=>{let e=t.result_data,s=e.shift();this.setData({hotPeople:e,currentPeople:s}),this.getUnitWidth()}})},swithTab(t){this.setData({currentPage:t.detail.item.key}),this.getPostList()},getFocusPeopleFeed(){app.request.getFocusPeopleFeed({params:{uid:wx.getStorageSync("u_id")},success:t=>{console.log(t)}})}}});
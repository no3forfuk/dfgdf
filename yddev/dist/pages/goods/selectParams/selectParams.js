const app=getApp();Component({properties:{goodsId:{type:String,value:""}},data:{paramData:[],defaultSelect:[]},methods:{setStandard(){const[t,e]=[this.data.defaultSelect,this.data.paramData];let a={},s=[];for(let d=0;d<e.length;d++){let r={},i=e[d].label,o=e[d].items[t[d]];r.label=i,r.value=o,s.push(r),i=this.filterEnglishCode(i),o=this.filterEnglishCode(o),a[i]=o}return wx.setStorage({key:"standardParams",data:s}),wx.setStorage({key:"encodeStandard",data:a}),a},filterEnglishCode(t){const e=/[A-z]/;for(var a=[],s=0;s<t.length;s++)e.test(t[s])?a[s]=t[s]:a[s]="\\u"+("00"+t.charCodeAt(s).toString(16)).slice(-4);return a.join("")},emitclose(){const t=this.setStandard();let e=JSON.stringify(t);e=e.replace(/\\u/g,"u"),app.request.searchStock({params:{commodity_id:this.properties.goodsId,property_json:e},success:t=>{t.code}}),this.triggerEvent("emitcloseselect",{standardJson:t})},onselected(t){const e=t.currentTarget.dataset,[a,s,d]=[e.index,e.idx,this.data.defaultSelect];d[a]!=s&&(d[a]=s,this.setData({defaultSelect:d}))},getGoodsStandard(){app.request.getGoodsStandard({params:{commodity_id:this.properties.goodsId},success:t=>{this.buildParamData(t)}})},buildParamData(t){const[e,a,s]=[t.data,this.data.paramData,this.data.defaultSelect];for(let t in e){let d={label:t,items:e[t]};a.push(d),s.push(0)}this.setData({paramData:a,defaultSelect:s})}},detached(){wx.setNavigationBarTitle({title:"商品详情"})},ready(){wx.setNavigationBarTitle({title:"选择规格"}),this.getGoodsStandard()}});
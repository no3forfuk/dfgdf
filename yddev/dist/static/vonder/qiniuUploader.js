!function(){var n={qiniuUploadURL:"",qiniuImageURLPrefix:"",qiniuUploadToken:"",qiniuUploadTokenURL:"",qiniuUploadTokenFunction:null};function i(i){n={qiniuUploadURL:"",qiniuImageURLPrefix:"",qiniuUploadToken:"",qiniuUploadTokenURL:"",qiniuUploadTokenFunction:null},function(i){i.uploadURL&&(n.qiniuUploadURL=i.uploadURL);i.uptoken?n.qiniuUploadToken=i.uptoken:i.uptokenURL?n.qiniuUploadTokenURL=i.uptokenURL:i.uptokenFunc&&(n.qiniuUploadTokenFunction=i.uptokenFunc);i.domain&&(n.qiniuImageURLPrefix=i.domain)}(i)}function o(i,o,u,e){var a=n.qiniuUploadURL,l=i.split("//")[1];e&&e.key&&(l=e.key);var U={token:n.qiniuUploadToken,key:l};wx.uploadFile({url:a,filePath:i,name:"file",formData:U,success:function(i){var u=i.data,e=JSON.parse(u),a=n.qiniuImageURLPrefix+e.key;e.imageURL=a,o(e)},fail:function(n){u(n)}})}module.exports={init:i,upload:function(u,e,a,l){if(null==u)return;l&&i(l);if(n.qiniuUploadToken)o(u,e,a,l);else if(n.qiniuUploadTokenURL)U=function(){o(u,e,a,l)},wx.request({url:n.qiniuUploadTokenURL,success:function(i){var o=i.data.uptoken;n.qiniuUploadToken=o,U&&U()},fail:function(n){}});else{if(!n.qiniuUploadTokenFunction)return;n.qiniuUploadToken=n.qiniuUploadTokenFunction()}var U}}}();